/*!
 * Extend Web3 for Ebakus Blockchain v0.1.7
 * 
 * @author Ebakus AG <hello@ebakus.com>
 * @website https://www.ebakus.com/
 * 
 * @copyright Ebakus 2020
 * @license MIT
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports["ebakus-pow"]=r():e.EbakusPoW=r()}(this,(function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=9)}([function(e,r){e.exports=require("eth-lib/lib/bytes")},function(e,r){e.exports=require("eth-lib/lib/rlp")},function(e,r,t){(function(r){e.exports=function(){return new r("./node_modules/web3-ebakus/lib/proofOfWork.node.worker.js")}}).call(this,t(10).Worker)},function(e,r){e.exports=require("core-js/modules/es6.promise")},function(e,r){e.exports=require("core-js/modules/es6.object.to-string")},function(e,r){e.exports=require("regenerator-runtime/runtime")},function(e,r){e.exports=require("core-js/modules/es6.regexp.to-string")},function(e,r){e.exports=require("core-js/modules/es7.symbol.async-iterator")},function(e,r){e.exports=require("core-js/modules/es6.symbol")},function(r,t,n){"use strict";n.r(t),n(7),n(8),n(5),n(3),n(6),n(4);var o,a=n(0),u=n.n(a),i=n(1),c=n.n(i),s=n(2),f=n.n(s),l=(n(11),function(e){return("string"==typeof e||"number"==typeof e)&&/^(-)?0x[0-9a-f]*$/i.test(e)});function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"createCalculateWorkForTransaction",(function(){return m})),n.d(t,"benchmarkWorkCallsPerSecond",(function(){return b}));var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=function(r){return e.hexToNumber?e.hexToNumber(r):parseInt(r,16)},t=function(r){return e.numberToHex?e.numberToHex(r):"0x".concat(r.toString(16))};return function(n,o,a,i){var s=!1;return i=i||function(){},n?Promise.resolve(function(n){var s,m,b,d,x,y,k,g;return regeneratorRuntime.async((function(w){for(;;)switch(w.prev=w.next){case 0:if(s=0,m=!1,null!==a&&"object"===p(a)&&(a.isRunning=function(){return m},a.getCurrentWorkNonce=function(){return s},a.kill=function(){m=!1,s=0,b&&b.terminate(),d&&d("Worker terminated by user")}),w.prev=3,o){w.next=12;break}if(!e.suggestDifficulty){w.next=11;break}return w.next=8,regeneratorRuntime.awrap(e.suggestDifficulty(n.from));case 8:o=w.sent,w.next=12;break;case 11:x=new Error("Ebakus calculateWorkForTransaction - opts.suggestDifficulty not provided");case 12:if(n.nonce||x){w.next=20;break}if(!e.getTransactionCount){w.next=19;break}return w.next=16,regeneratorRuntime.awrap(e.getTransactionCount(n.from));case 16:n.nonce=w.sent,w.next=20;break;case 19:x=new Error("Ebakus calculateWorkForTransaction - opts.getTransactionCount not provided");case 20:if(n.gas||x){w.next=28;break}if(!e.estimateGas){w.next=27;break}return w.next=24,regeneratorRuntime.awrap(e.estimateGas(n));case 24:n.gas=w.sent,w.next=28;break;case 27:x=new Error("Ebakus calculateWorkForTransaction - opts.estimateGas not provided");case 28:if(!x){w.next=31;break}return i(x),w.abrupt("return",Promise.reject(x));case 31:return n.gasPrice="0",e.inputCallFormatter&&(n=e.inputCallFormatter(n)),y=c.a.encode([u.a.fromNat(n.nonce),u.a.fromNat(n.gas),n.to?n.to.toLowerCase():"",u.a.fromNat(n.value||"0x"),n.data||"0x"]),k=l(n.gas)?r(n.gas):n.gas,g={hash:y,targetDifficulty:o*k},w.abrupt("return",new Promise((function(e,r){b=new f.a,d=r,b.on("message",(function(r){var o=r.cmd,a=r.workNonce;switch(o){case"ready":m=!0,b.postMessage(g);break;case"current":s=a;break;case"finished":n.workNonce=t(a),s=n.workNonce,m=!1,b.terminate(),i(null,n),e(n);break;default:console.warn("Unknown data from worker",r)}})),b.on("error",(function(e){throw e})),b.on("exit",(function(e){if(1===e)return null;var r=new Error("Worker has stopped with code ".concat(e));return i(r),Promise.reject(r)}))})));case 39:return w.prev=39,w.t0=w.catch(3),i(w.t0),w.abrupt("return",Promise.reject(w.t0));case 43:case"end":return w.stop()}}),null,null,[[3,39]])}(n)):(s=new Error("No transaction object given!"),i(s),Promise.reject(s))}},b=function(r){return o&&o>0?Promise.resolve(o):(r=r||function(){},Promise.resolve(regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,n={benchmark:!0},a.abrupt("return",new Promise((function(a){(t=new f.a).on("message",(function(u){var i=u.cmd,c=u.callsPerSecond;switch(i){case"ready":t.postMessage(n);break;case"finished":t.terminate(),o=c,r(null,c),a(c);break;default:console.warn("Unknown data from worker",e.data)}})),t.on("error",(function(e){throw e})),t.on("exit",(function(e){if(1===e)return null;var t=new Error("Worker has stopped with code ".concat(e));return r(t),Promise.reject(t)}))})));case 5:return a.prev=5,a.t0=a.catch(0),r(a.t0),a.abrupt("return",Promise.reject(a.t0));case 9:case"end":return a.stop()}}),null,null,[[0,5]])));var t,n}},function(e,r){e.exports=require("worker_threads")},function(e,r){e.exports=require("core-js/modules/es6.typed.uint8-array")}]).createCalculateWorkForTransaction}));