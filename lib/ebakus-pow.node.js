/*!
 * Extend Web3 for Ebakus Blockchain v0.1.9
 * 
 * @author Ebakus AG <hello@ebakus.com>
 * @website https://www.ebakus.com/
 * 
 * @copyright Ebakus 2020
 * @license MIT
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports["ebakus-pow"]=r():e.EbakusPoW=r()}(this,(function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=7)}([function(e,r){e.exports=require("@babel/runtime/regenerator")},function(e,r){e.exports=require("eth-lib/lib/bytes")},function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,r,t){(function(r){e.exports=function(){return new r("./node_modules/web3-ebakus/lib/proofOfWork.node.worker.js")}}).call(this,t(6).Worker)},function(e,r){e.exports=require("@babel/runtime/helpers/typeof")},function(e,r){e.exports=require("eth-lib/lib/rlp")},function(e,r){e.exports=require("worker_threads")},function(r,t,n){"use strict";n.r(t);var o,a=n(0),u=n.n(a),i=n(4),c=n.n(i),s=n(2),f=n.n(s),l=n(1),p=n.n(l),b=n(5),d=n.n(b),m=n(3),k=n.n(m),x=function(e){return("string"==typeof e||"number"==typeof e)&&/^(-)?0x[0-9a-f]*$/i.test(e)};n.d(t,"createCalculateWorkForTransaction",(function(){return v})),n.d(t,"benchmarkWorkCallsPerSecond",(function(){return w}));var v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=function(r){return e.hexToNumber?e.hexToNumber(r):parseInt(r,16)},t=function(r){return e.numberToHex?e.numberToHex(r):"0x".concat(r.toString(16))};return function(n,o,a,i){var s=!1;if(i=i||function(){},!n)return s=new Error("No transaction object given!"),i(s),Promise.reject(s);var l=function(){var n=f()(u.a.mark((function n(s){var f,l,b,m,v,w,g,h;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(f=0,l=!1,null!==a&&"object"===c()(a)&&(a.isRunning=function(){return l},a.getCurrentWorkNonce=function(){return f},a.kill=function(){l=!1,f=0,b&&b.terminate(),m&&m("Worker terminated by user")}),n.prev=3,o){n.next=12;break}if(!e.suggestDifficulty){n.next=11;break}return n.next=8,e.suggestDifficulty(s.from);case 8:o=n.sent,n.next=12;break;case 11:v=new Error("Ebakus calculateWorkForTransaction - opts.suggestDifficulty not provided");case 12:if(s.nonce||v){n.next=20;break}if(!e.getTransactionCount){n.next=19;break}return n.next=16,e.getTransactionCount(s.from);case 16:s.nonce=n.sent,n.next=20;break;case 19:v=new Error("Ebakus calculateWorkForTransaction - opts.getTransactionCount not provided");case 20:if(s.gas||v){n.next=28;break}if(!e.estimateGas){n.next=27;break}return n.next=24,e.estimateGas(s);case 24:s.gas=n.sent,n.next=28;break;case 27:v=new Error("Ebakus calculateWorkForTransaction - opts.estimateGas not provided");case 28:if(!v){n.next=31;break}return i(v),n.abrupt("return",Promise.reject(v));case 31:return s.gasPrice="0",e.inputCallFormatter&&(s=e.inputCallFormatter(s)),w=d.a.encode([p.a.fromNat(s.nonce),p.a.fromNat(s.gas),s.to?s.to.toLowerCase():"",p.a.fromNat(s.value||"0x"),s.data||"0x"]),g=x(s.gas)?r(s.gas):s.gas,h={hash:w,targetDifficulty:o*g},n.abrupt("return",new Promise((function(e,r){b=new k.a,m=r,b.on("message",(function(r){var n=r.cmd,o=r.workNonce;switch(n){case"ready":l=!0,b.postMessage(h);break;case"current":f=o;break;case"finished":s.workNonce=t(o),f=s.workNonce,l=!1,b.terminate(),i(null,s),e(s);break;default:console.warn("Unknown data from worker",r)}})),b.on("error",(function(e){throw e})),b.on("exit",(function(e){if(1===e)return null;var r=new Error("Worker has stopped with code ".concat(e));return i(r),Promise.reject(r)}))})));case 39:return n.prev=39,n.t0=n.catch(3),i(n.t0),n.abrupt("return",Promise.reject(n.t0));case 43:case"end":return n.stop()}}),n,null,[[3,39]])})));return function(e){return n.apply(this,arguments)}}();return Promise.resolve(l(n))}},w=function(r){if(o&&o>0)return Promise.resolve(o);r=r||function(){};var t=function(){var t=f()(u.a.mark((function t(){var n,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a={benchmark:!0},t.abrupt("return",new Promise((function(t){(n=new k.a).on("message",(function(u){var i=u.cmd,c=u.callsPerSecond;switch(i){case"ready":n.postMessage(a);break;case"finished":n.terminate(),o=c,r(null,c),t(c);break;default:console.warn("Unknown data from worker",e.data)}})),n.on("error",(function(e){throw e})),n.on("exit",(function(e){if(1===e)return null;var t=new Error("Worker has stopped with code ".concat(e));return r(t),Promise.reject(t)}))})));case 5:return t.prev=5,t.t0=t.catch(0),r(t.t0),t.abrupt("return",Promise.reject(t.t0));case 9:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(){return t.apply(this,arguments)}}();return Promise.resolve(t())}}]).createCalculateWorkForTransaction}));